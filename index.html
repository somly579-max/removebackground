<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI និយាយភាសាខ្មែរ</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#22c55e;--text:#e6eef8}
    body{font-family:'Khmer OS Battambang', system-ui, sans-serif; background:linear-gradient(135deg,#041025 0%, #071a2b 100%); color:var(--text); margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{background:rgba(255,255,255,0.05);backdrop-filter:blur(6px);border-radius:12px;padding:20px;max-width:820px;width:100%;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:22px}
    p.lead{margin:0 0 16px;opacity:0.9}
    textarea{width:100%;min-height:140px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.25);color:var(--text);resize:vertical;font-family:'Khmer OS Battambang'}
    .row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .btn{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:8px;cursor:pointer}
    select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.2);color:var(--text)}
    .small{font-size:13px;opacity:0.85}
    .responseBox{margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);min-height:56px}
  </style>
</head>
<body>
  <div class="card">
    <h1>AI និយាយភាសាខ្មែរ</h1>
    <p class="lead">សរសេរអត្ថបទជាភាសាខ្មែរហើយចុច <strong>និយាយ</strong>។ វានឹងអានអត្ថបទជាសំលេងខ្មែរអោយអ្នកស្តាប់។</p>

    <label class="small">អត្ថបទ៖</label>
    <textarea id="inputText" placeholder="សូមសរសេរអត្ថបទនៅទីនេះ..."></textarea>

    <div class="row">
      <label class="small">ជ្រើសសំលេង:</label>
      <select id="voiceSelect"></select>
      <button id="speakBtn" class="btn">និយាយ</button>
    </div>

    <div class="responseBox" id="responseBox">សំលេងនឹងចេញនៅទីនេះ...</div>
  </div>

  <script>
    const voiceSelect = document.getElementById('voiceSelect');
    const speakBtn = document.getElementById('speakBtn');
    const inputText = document.getElementById('inputText');
    const responseBox = document.getElementById('responseBox');

    function loadVoices(){
      const voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '';
      const khVoices = voices.filter(v => v.lang.toLowerCase().includes('km'));
      const allVoices = khVoices.length > 0 ? khVoices : voices;
      allVoices.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v.name + '|' + v.lang;
        opt.textContent = `${v.name} — ${v.lang}`;
        voiceSelect.appendChild(opt);
      });
      if(allVoices.length===0){
        const opt = document.createElement('option');
        opt.textContent = '(មិនមានសំលេង)';
        voiceSelect.appendChild(opt);
      }
    }

    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    function speakText(text){
      if(!text) return;
      const utter = new SpeechSynthesisUtterance(text);
      const sel = voiceSelect.value;
      if(sel && sel.includes('|')){
        const [name, lang] = sel.split('|');
        const match = speechSynthesis.getVoices().find(v => v.name===name && v.lang===lang);
        if(match) utter.voice = match;
      }
      utter.lang = utter.voice?.lang || 'km-KH';
      utter.pitch = 1;
      utter.rate = 1;

      utter.onstart = ()=>{ speakBtn.textContent = 'កំពុងនិយាយ...'; speakBtn.disabled = true; }
      utter.onend = ()=>{ speakBtn.textContent = 'និយាយ'; speakBtn.disabled = false; }
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

    speakBtn.addEventListener('click', ()=>{
      const text = inputText.value.trim();
      if(!text){ alert('សូមសរសេរអត្ថបទជាមុន'); return; }
      responseBox.textContent = text;
      speakText(text);
    });
  </script>
</body>
</html>
